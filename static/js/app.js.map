{"version":3,"sources":["app/js/custom.js","app/js/homepagescripts.js","app/js/initialize.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArPA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA","file":"static/js/app.js","sourcesContent":["$(document).ready(function () {\n    $('.clickable-row').click(function () {\n        window.location = $(this).data(\"href\");\n    });\n});\n","$(document).ready(function () {\n    var body = $('body');\n\n    function csrfSafeMethod(method) {\n        // these HTTP methods do not require CSRF protection\n        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\n    }\n\n    var csrftoken = $(\"[name=csrfmiddlewaretoken]\").val();\n\n    $.ajaxSetup({\n        beforeSend: function (xhr, settings) {\n            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {\n                xhr.setRequestHeader(\"X-CSRFToken\", csrftoken);\n            }\n        }\n    });\n\n    $('#display-only-toggle-button').click(function() {\n        body.toggleClass('context-display-only');\n        $(this).toggleClass('text-muted')\n    });\n\n    body.on('click', '.combatant-context-enter', function () {\n        var combatant = $(this).data('combatant');\n        body.addClass('context-combatant').data('combatant', combatant);\n        label_matched_combatants()\n    });\n    body.on('click', '.combatant-context-leave', function () {\n        body.removeClass('context-combatant').data('combatant', '');\n        $('.context-combatant-match').each(function () {\n            $(this).removeClass('context-combatant-match');\n        });\n    });\n\n    $('.enter-apply-context').click(function () {\n        var which_context_type = $(this).data('apply-effect-type');\n        body.addClass('context-apply').data('apply-effect-type', which_context_type);\n    });\n\n    $('.exit-apply-context').click(exit_apply_context);\n\n    $('#effect-to-apply').on(\"change paste keyup\", function () {\n        var myval = $(this).val();\n        var active_combatant_buttons = $('.context-activatable.active');\n        if (myval === '') {\n            $('#apply-button').prop('disabled', true);\n        } else if (active_combatant_buttons.length) {\n            $('#apply-button').prop('disabled', false);\n        }\n        active_combatant_buttons.each(function () {\n            var combatant = $(this).data('combatant');\n            $('#' + combatant + '-' + body.data('apply-effect-type')).val(myval)\n        })\n    });\n\n    var effect_add_form = $('#effect-add-form');\n    effect_add_form.submit(function () {\n        $.ajax({\n            type: effect_add_form.attr('method'),\n            url: effect_add_form.attr('action'),\n            data: effect_add_form.serialize(),\n            success: function (data) {\n                $(\".combatant-card-body\").each(function () {\n                    // todo change combatant card body data-id to data-combatant\n                    var id = $(this).data('id');\n                    $(this).html(data[id]);\n                });\n\n            }\n        });\n        exit_apply_context();\n        $('#effect-to-apply').val('');\n        return false;\n    });\n\n    body.on('click', '.remove-effect', function () {\n        var index = $(this).data('index');\n        var effect_type = $(this).data('effect-type');\n        var combatant_id = $(this).data('combatant');\n\n        $.ajax({\n            type: 'post',\n            url: '/ajax/remove-effect/',\n            data: {\n                'index': index,\n                'effect_type': effect_type,\n                'combatant': combatant_id\n            },\n            success: function (return_html) {\n                if (return_html === '') {\n                    return\n                }\n                $(\".combatant-card-body\").each(function () {\n                    if ($(this).data('id') === combatant_id) {\n                        $(this).html(return_html);\n                    }\n                });\n            }\n        })\n    });\n\n    body.on('click', '#enter-remove-context', function () {\n        body.addClass('context-remove');\n    });\n\n    var remove_combatants_form = $('#remove-combatants-form');\n    remove_combatants_form.submit(function () {\n        $.ajax({\n            type: remove_combatants_form.attr('method'),\n            url: remove_combatants_form.attr('action'),\n            data: remove_combatants_form.serialize(),\n            success: function (return_html) {\n                if (return_html === '') {\n                    return\n                }\n                $('#combatant-card-deck').html(return_html);\n                label_matched_combatants();\n            }\n        });\n        exit_remove_context();\n        return false;\n    });\n\n\n    body.on('click', '.context-activatable', function () {\n        $(this).toggleClass('active');\n        var combatant = $(this).data('combatant');\n        if (body.hasClass('context-remove')) {\n            var combatant_to_remove_selector = $(\"#combatant-to-remove-\" + combatant);\n            if ($(this).hasClass('active')) {\n                combatant_to_remove_selector.val('True')\n            } else {\n                combatant_to_remove_selector.val('')\n            }\n            if ($('.context-activatable.active').length) {\n                $('#confirm-remove-combatants-button').prop('disabled', false);\n            } else {\n                $('#confirm-remove-combatants-button').prop('disabled', true);\n            }\n        }\n        if (body.hasClass('context-apply')) {\n            var effect = '';\n            var effect_to_apply = $('#effect-to-apply').val();\n            var apply_effect_type = body.data('apply-effect-type');\n            if ($(this).hasClass('active')) {\n                effect = effect_to_apply\n            }\n            $('#' + combatant + '-' + apply_effect_type).val(effect);\n            if (effect_to_apply !== '') {\n                if ($('.context-activatable.active').length) {\n                    $('#apply-button').prop('disabled', false);\n                } else {\n                    $('#apply-button').prop('disabled', true);\n                }\n            }\n        }\n    });\n\n    body.on('click', '#cancel-remove', exit_remove_context);\n\n    body.on('submit', '.update-initiative-form', function () {\n        $.ajax({\n            type: $(this).attr('method'),\n            url: $(this).attr('action'),\n            data: $(this).serialize(),\n            success: function (return_html) {\n                if (return_html === '') {\n                    return\n                }\n                $(\"#combatant-card-deck\").html(return_html);\n                label_matched_combatants();\n            }\n        });\n        return false;\n    });\n    var last_updated = new Date().getTime();\n    setTimeout(function () {\n        poll_server(last_updated)\n    }, 2500);\n});\n\nfunction exit_apply_context() {\n    $('body').removeClass('context-apply');\n    $('.effect-input').val('');\n    $('.context-activatable').removeClass('active');\n    $('#apply-button').prop('disabled', true)\n}\n\nfunction exit_remove_context() {\n    $('body').removeClass('context-remove');\n    $('.combatant-to-remove').val('');\n    $('.context-activatable').removeClass('active');\n    $('#confirm-remove-combatants-button').prop('disabled', true)\n}\n\nfunction poll_server(last_updated) {\n    $.ajax({\n        type: 'get',\n        url: '/ajax/poll/',\n        data: {\n            last_updated: last_updated\n        },\n        success: function (return_data) {\n            if (return_data.needs_update) {\n                update_all_combatants();\n                last_updated = new Date().getTime();\n            }\n        },\n        complete: function (data) {\n            setTimeout(function () {\n                poll_server(last_updated)\n            }, 2500);\n        }\n    })\n}\n\nfunction update_all_combatants() {\n    var url = '/ajax/update-all-combatants/';\n    $.ajax({\n        type: 'post',\n        url: url,\n        data: {},\n        success: function (return_html) {\n            if (return_html === '') {\n                return\n            }\n            $(\"#combatant-card-deck\").html(return_html);\n            label_matched_combatants();\n        }\n    });\n}\n\nfunction label_matched_combatants() {\n    var body = $('body');\n    if (body.hasClass('context-combatant')) {\n        var combatant = body.data('combatant');\n        if (combatant) {\n            $('.combatant-context-match-hide, .combatant-context-unmatch-hide').each(function () {\n                if ($(this).data('combatant') === combatant) {\n                    $(this).addClass('context-combatant-match')\n                }\n            });\n        }\n    }\n}","document.addEventListener('DOMContentLoaded', function() {\r\n  // do your setup here\r\n  console.log('Initialized app');\r\n});\r\n"]}